<mat-card>
  <h2>ðŸ“¥ Results Upload</h2>

  <!-- Filters -->
    <div class="filters">
        <mat-form-field appearance="fill">
        <mat-label>Class</mat-label>
        <mat-select [(ngModel)]="selectedClass">
            <mat-option *ngFor="let c of classes" [value]="c">{{ c }}</mat-option>
        </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill">
        <mat-label>Term</mat-label>
        <mat-select [(ngModel)]="selectedTerm">
            <mat-option *ngFor="let t of terms" [value]="t">{{ t }}</mat-option>
        </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill">
        <mat-label>Session</mat-label>
        <mat-select [(ngModel)]="selectedSession">
            <mat-option *ngFor="let s of sessions" [value]="s">{{ s }}</mat-option>
        </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill">
        <mat-label>Subject</mat-label>
        <mat-select [(ngModel)]="selectedSubject">
            <mat-option *ngFor="let sub of subjects" [value]="sub">{{ sub }}</mat-option>
        </mat-select>
        </mat-form-field>
    </div>

    <div class="import-export">
        <button mat-flat-button color="accent" (click)="exportToExcel()">
            <mat-icon>table_view</mat-icon> 
            Export Excel
        </button>
        <input type="file" (change)="importExcel($event)" accept=".xlsx, .xls" style="margin-top: 1rem;" />
    </div>


    <!-- Result Table -->
    <table mat-table [dataSource]="students" class="mat-elevation-z2 result-table">
        <!-- Name -->
        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Student </th>
            <td mat-cell *matCellDef="let s"> {{ s.name }} </td>
        </ng-container>

        <!-- CA -->
        <ng-container matColumnDef="ca">
            <th mat-header-cell *matHeaderCellDef> CA (30) </th>
            <td mat-cell *matCellDef="let s">
                <input matInput type="number" [(ngModel)]="s.ca" (input)="recalculate(s)" />
            </td>
        </ng-container>

        <!-- Exam -->
        <ng-container matColumnDef="exam">
            <th mat-header-cell *matHeaderCellDef> Exam (70) </th>
            <td mat-cell *matCellDef="let s">
                <input matInput type="number" [(ngModel)]="s.exam" (input)="recalculate(s)" />
            </td>
        </ng-container>

        <!-- Total -->
        <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef> Total </th>
            <td mat-cell *matCellDef="let s"> {{ s.total }} </td>
        </ng-container>

        <!-- Grade -->
        <ng-container matColumnDef="grade">
            <th mat-header-cell *matHeaderCellDef> Grade </th>
            <td mat-cell *matCellDef="let s"> {{ s.grade }} </td>
        </ng-container>

        <!-- Remark -->
        <ng-container matColumnDef="remark">
            <th mat-header-cell *matHeaderCellDef> Remark </th>
            <td mat-cell *matCellDef="let s">
                <input matInput [(ngModel)]="s.remark" placeholder="e.g. Great job" />
            </td>
        </ng-container>

            <!-- Position -->
        <ng-container matColumnDef="position">
            <th mat-header-cell *matHeaderCellDef> Position </th>
            <td mat-cell *matCellDef="let s"> {{ s.position }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div class="save-btn">
        <button mat-flat-button color="primary" (click)="saveResults()">
        <mat-icon>save</mat-icon> Save Results
        </button>
    </div>
</mat-card>
